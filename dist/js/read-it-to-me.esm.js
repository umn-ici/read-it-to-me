import e from"react";var t,n,r="read-it-to-me-content-group",o=0,a=1,i=2,c=function(e,t){var n=e.cloneNode(!0),r=""===t?".read-it-to-me-control-bubble":t+", .read-it-to-me-control-bubble";return n.querySelectorAll(r).forEach((function(e){e.remove()})),n.querySelectorAll("img[alt]").forEach((function(e){var t=e.alt;t.length>0&&e.replaceWith("Image description begin. ".concat(t," Image description end."))})),n.querySelectorAll("p, li, abbr, strong, em, h1, h2, h3, h4, h5, h6").forEach((function(e){var t=e.tagName.toUpperCase();if("P"===t)e.appendChild(document.createTextNode(". "));else if("ABBR"===t){var n=e.textContent.split("");e.textContent=n.join(".")}else"STRONG"===t||"EM"===t?(e.insertBefore(document.createTextNode(", "),e.firstChild),e.appendChild(document.createTextNode(", "))):"LI"===t?e.appendChild(document.createTextNode(", ")):"H1"!==t&&"H2"!==t&&"H3"!==t&&"H4"!==t&&"H5"!==t&&"H6"!==t||e.appendChild(document.createTextNode(", "))})),n.textContent};function s(){}function l(e){return function(t){try{e(t)}catch(e){}}}var u=!0,d=function(){var e={play:s,pause:s,cancel:s,toggle:s};return{eventsBin:e,setHandlers:function(t){t&&(t.play&&"function"==typeof t.play&&(e.play=l(t.play)),t.pause&&"function"==typeof t.pause&&(e.pause=l(t.pause)),t.cancel&&"function"==typeof t.cancel&&(e.cancel=l(t.cancel)),t.toggle&&"function"==typeof t.toggle&&(e.toggle=l(t.toggle)))}}}(),p=d.eventsBin,f=d.setHandlers,h=function(e,r){var o;e?(u=!0,sessionStorage.removeItem("readItToMeDisabled")):(u=!1,(o=document.querySelector(".".concat("focusin")))&&o.classList.remove("focusin"),t.cancel(),sessionStorage.setItem("readItToMeDisabled","1")),n.setReadItToMe(u),r&&p.toggle(e)},m=function(e){return function(){p.cancel(t.currentUtterance&&t.currentUtterance.config.group.ritmOptionalTrackingIdentifier),e.contains(this)&&e.focus(),t.cancel()}},v=function(e){if(t.currentUtterance&&t.currentUtterance.config.group===e&&e.state!==o)e.state===a?t.resume():e.state===i&&t.pause();else{var n={text:e.text(),group:e,playTracked:!1};t.play(n,b)}},b=function(e,t,r){r.group.setState(t),t===o?(n.hideControlBar(),n.hideCancelButton()):(n.showControlBar(),n.showCancelButton()),t===i?r.playTracked||(p.play(r.group.ritmOptionalTrackingIdentifier),r.playTracked=!0):t===a&&p.pause(r.group.ritmOptionalTrackingIdentifier)};function y(e,r){!function(e,t){var n=[],r=!1;if(e||"undefined"==typeof speechSynthesis||(e=speechSynthesis),e){var c=function t(){var n=s.currentUtterance=s.nextUttarance;function r(e){n.callback(e,o,n.config),s.nextUttarance?t():s.currentUtterance=null}s.nextUttarance=null,n.u.onend=function(){return setTimeout(r,100)},n.u.onerror=function(e){return setTimeout(r.bind(null,e.error||new Error("Unknown speech synthesis error")),100)},n.u.onstart=function(){return n.callback(null,i,n.config)},n.u.onpause=function(){return n.callback(null,a,n.config)},n.u.onresume=function(){return n.callback(null,i,n.config)},e.speak(n.u)},s={play:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},o=new SpeechSynthesisUtterance(t.text);if(o.lang="en-US",o.rate=.8,n.length>0)for(var a=0;a<n.length;a++)if(0===n[a].lang.indexOf("en")&&"Samantha"===n[a].name){o.voice=n[a];break}s.nextUttarance={u:o,config:t,callback:r},s.currentUtterance?e.cancel():c()},pause:function(){e.pause()},resume:function(){e.resume()},cancel:function(){e.cancel()}};0===(n=e.getVoices()).length&&(void 0!==e.onvoiceschanged?e.onvoiceschanged=function(){n=e.getVoices(),t(null,s)}:r=!0),e.cancel(),!n.length&&r?t(new Error("Unable to load voice list")):n.length&&t(null,s)}else t(new Error("Speech Synthesis is unavailable."))}(void 0,(function(o,a){if(!o&&a){t=a;var i=e();i&&i.hideControlBar&&i.hideCancelButton&&i.showCancelButton&&i.showControlBar&&i.setReadItToMe?(n=i,sessionStorage.getItem("readItToMeDisabled")&&h(!1)):o=new Error("UI library did not provide necessary callbacks.")}r(o)}))}function g(){return u}var C,w,T=f;function k(e,t){var n=e.cancelAudio,r=e.setReadItToMe,o=t.document,a=t.controlBarElement,i=a||o.createElement("div");i.classList.add("read-it-to-me-control-bar"),i.setAttribute("tabindex","0"),i.setAttribute("aria-describedby","ritm-sr-message"),i.innerHTML='<div class="toggle-wrapper">\n                            <p class="visually-hidden" id="ritm-sr-message">Screen-reader users: there is a rudimentary "on-demand" read-aloud feature in use on this page called "Read-it-to-Me".  This new feature, which isn\'t meant as a screen-reader alternative, adds more tabable areas in the document which are great for keyboard users not using screen-readers, but are likely to be annoying for you. You can toggle off/on "Read-it-to-Me" using this checkbox.</p>\n                            <p class="read-it-to-me-label">Toggle Read-it-to-Me</p>\n                            <label class="switch" aria-label="Toggle Read-it-to-Me." aria-describedby="ritm-sr-message">\n                              <input type="checkbox" class="switch-input" checked>\n                              <span class="switch-outline"></span>\n                              <span class="switch-label" data-on="On" data-off="Off"></span>\n                              <span class="switch-handle"></span>\n                            </label>\n                          </div>\n                          <div class="cancel-audio-wrapper">\n                            <button type="button" class="btn btn-default btn-lg">Cancel audio</button>\n                          </div>';var c=i.querySelector("button"),s=i.querySelector("input.switch-input"),l=function(){i.classList.add("control-bar-show")},u=function(){i.classList.remove("control-bar-show")};if(c.addEventListener("click",n(i)),s.addEventListener("change",(function(e){r(e.target.checked,!0)})),i.addEventListener("focusin",(function(e){e.target&&i.contains(e.target)&&(i.classList.contains("control-bar-show")||l())})),i.addEventListener("focusout",(function(e){(e.relatedTarget&&!i.contains(e.relatedTarget)||!e.relatedTarget)&&u()})),!a){var d=o.body;d.insertBefore(i,d.firstChild)}return{showCancelButton:function(){i.classList.add("show-ritm-cancel")},hideCancelButton:function(){i.classList.remove("show-ritm-cancel")},showControlBar:l,hideControlBar:u,setReadItToMe:function(e){return s.checked=e}}}function E(e,t){var n=e.playPauseGroup,r=e.cancelAudio,c=e.focusClassName,s=e.ritmDisabledClassName,l=e.ritmOptionalTrackingIdentifier,u=e.elem,d=e.text,p=t.wrapperElement,f=t.controlBubbleElement,h=t.document,m=p||h.createElement("div");if(m.classList.add("read-this-to-me"),!p)for(u.appendChild(m);u.firstChild!==m;)m.appendChild(u.firstChild);var v=f||h.createElement("div");v.classList.add("read-it-to-me-control-bubble"),v.tabIndex=-1,v.innerHTML='<p class="read-it-to-me-label"></p><button type="button" class="play-pause-resume"></button><button type="button" class="cancel-audio"><span class="visually-hidden">Cancel audio</a></button>';var b=v.querySelector("button.play-pause-resume"),y=v.querySelector("button.cancel-audio"),g=function(e){e.stopPropagation(),u.classList.add(c)},C=function(e){e.stopPropagation(),u.classList.remove(c)},w=function(e){e.stopPropagation(),n(k)},T=r(v);v.addEventListener("focusin",g),v.addEventListener("focusout",C),b.addEventListener("click",w),y.addEventListener("click",T),f||u.insertBefore(v,m);var k={setReadItToMe:function(e){e?u.classList.remove(s):u.classList.add(s),b.disabled=!e,y.disabled=!e},setState:function(e){k.state=e,e===o?(u.classList.remove("read-it-to-me-play"),u.classList.remove("read-it-to-me-pause")):e===i?(u.classList.add("read-it-to-me-play"),u.classList.remove("read-it-to-me-pause")):e===a&&(u.classList.remove("read-it-to-me-play"),u.classList.add("read-it-to-me-pause"))},state:o,destroy:function(){v.removeEventListener("focusin",g),v.removeEventListener("focusout",C),b.removeEventListener("click",w),y.removeEventListener("click",T)},text:d,ritmOptionalTrackingIdentifier:l};return k}function B(e,t,n){(t&&document.querySelectorAll(t).length>0||document.querySelectorAll(".".concat(r)).length>0)&&e((function(){var e;t&&document.querySelectorAll(t).length>0&&document.querySelectorAll(t).forEach((function(e){e.classList.add(r)}));var o=[];return document.querySelectorAll(".".concat(r)).forEach((function(e){var t=e.dataset.ritmOptionalTrackingIdentifier||!1,r=E({playPauseGroup:v,cancelAudio:m,focusClassName:"focusin",ritmDisabledClassName:"ritm-disabled",elem:e,ritmOptionalTrackingIdentifier:t,text:function(){return c(e.querySelector(".read-this-to-me"),n)}},{document:document});o.push(r)})),{hideControlBar:(e=k({cancelAudio:m,setReadItToMe:h},{document:document})).hideControlBar,hideCancelButton:e.hideCancelButton,showCancelButton:e.showCancelButton,showControlBar:e.showControlBar,setReadItToMe:function(t){e.setReadItToMe(t),o.forEach((function(e){return e.setReadItToMe(t)}))}}}),(function(e){e&&document.querySelectorAll(".".concat(r)).forEach((function(e){e.classList.remove(r,"focusin")}))}))}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t&&O(e.prototype,t),n&&O(e,n),e}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?j(e):t}function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var o=P(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return A(this,n)}}if(void 0!==e){var N=e.createContext(!0);C=function(t){x(r,e.Component);var n=G(r);function r(e){var t;return S(this,r),(t=n.call(this,e)).state={ritm:!1,onGroupMounted:t.onGroupMounted.bind(j(t))},t}return I(r,[{key:"onGroupMounted",value:function(){var e=this;this.initialized||(this.initialized=!0,y((function(){return e.controlBar=k({cancelAudio:m,setReadItToMe:h},{document:document}),{hideControlBar:e.controlBar.hideControlBar,hideCancelButton:e.controlBar.hideCancelButton,showCancelButton:e.controlBar.showCancelButton,showControlBar:e.controlBar.showControlBar,setReadItToMe:e.uiSetReadItToMe.bind(e)}}),(function(t){!t&&g()&&e.setState({ritm:g()})})),T({play:this.onPlay.bind(this),pause:this.onPause.bind(this),cancel:this.onCancel.bind(this),toggle:this.onToggle.bind(this)}))}},{key:"onPlay",value:function(){var e;this.props.onPlay&&(e=this.props).onPlay.apply(e,arguments)}},{key:"onPause",value:function(){var e;this.props.onPause&&(e=this.props).onPause.apply(e,arguments)}},{key:"onCancel",value:function(){var e;this.props.onCancel&&(e=this.props).onCancel.apply(e,arguments)}},{key:"onToggle",value:function(){var e;this.props.onToggle&&(e=this.props).onToggle.apply(e,arguments)}},{key:"uiSetReadItToMe",value:function(e){this.controlBar&&this.controlBar.setReadItToMe(e),this.setState({ritm:e})}},{key:"componentWillUnmount",value:function(){"undefined"!=typeof console&&console.error("Having the Read-it-to-Me Control Context unmount may cause unexpected side effects.")}},{key:"render",value:function(){return e.createElement(N.Provider,{value:this.state},this.props.children)}}]),r}(),w=function(t){x(r,e.Component);var n=G(r);function r(e){var t;return S(this,r),(t=n.call(this,e)).componentRender=t.componentRender.bind(j(t)),t}return I(r,[{key:"componentRender",value:function(t){var n=t.ritm,r=t.onGroupMounted;return e.createElement(q,R(R({},this.props),{},{ritmState:n,onGroupMounted:r}),this.props.children)}},{key:"render",value:function(){return e.createElement(N.Consumer,{},this.componentRender)}}]),r}();var q=function(t){x(o,e.Component);var n=G(o);function o(){return S(this,o),n.apply(this,arguments)}return I(o,[{key:"componentDidMount",value:function(){var e=this,t=this.props.trackingIdentifier,n=this.props.filterOutTheseSelectors||"";this.ritmGroup=E({playPauseGroup:v,cancelAudio:m,focusClassName:"focusin",ritmDisabledClassName:"ritm-disabled",elem:this.elem,ritmOptionalTrackingIdentifier:t,text:function(){return c(e.wrapperElement,n)}},{wrapperElement:this.wrapperElement,controlBubbleElement:this.controlBubbleElement}),this.ritmGroup.setReadItToMe(this.props.ritmState),this.props.onGroupMounted()}},{key:"componentDidUpdate",value:function(e,t,n){e.ritmState!==this.props.ritmState&&this.ritmGroup.setReadItToMe(this.props.ritmState)}},{key:"componentWillUnmount",value:function(){this.ritmGroup&&(this.ritmGroup.destroy(),this.ritmGroup=null)}},{key:"render",value:function(){var t=this;return e.createElement("div",{className:r,ref:function(e){return t.elem=e}},e.createElement("div",{ref:function(e){return t.controlBubbleElement=e}}),e.createElement("div",{className:"read-this-to-me",ref:function(e){return t.wrapperElement=e}},this.props.children))}}]),o}()}var D=y,H=g,_=function(){return t.currentUtterance&&t.currentUtterance.config.group.ritmOptionalTrackingIdentifier||!1},W=T,z=C,V=w;function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return B(y,e,t)}export{V as ContentGroup,z as ControlContext,_ as currentUtteranceIdentifier,W as eventTracking,Y as init,D as initRITM,H as isEnabled};
//# sourceMappingURL=read-it-to-me.esm.js.map
