!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).ReadItToMe={},e.React)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n,o,r="ritm-disabled",a="read-it-to-me-content-group",i="focusin",c={STOPPED:0,PAUSED:1,PLAYING:2},s=function(e){var t=e.cloneNode(!0);return t.querySelectorAll("p, li, abbr, strong, em, h1, h2, h3, h4, h5, h6").forEach(function(e){var t=e.tagName.toUpperCase();if("P"===t)e.appendChild(document.createTextNode(". "));else if("ABBR"===t){var n=e.textContent.split("");e.textContent=n.join(".")}else"STRONG"===t||"EM"===t?(e.insertBefore(document.createTextNode(", "),e.firstChild),e.appendChild(document.createTextNode(", "))):"LI"===t?e.appendChild(document.createTextNode(", ")):"H1"!==t&&"H2"!==t&&"H3"!==t&&"H4"!==t&&"H5"!==t&&"H6"!==t||e.appendChild(document.createTextNode(", "))}),t.textContent};function l(){}function u(e){return function(t){try{e(t)}catch(e){}}}var d=!0,p=function(){var e={play:l,pause:l,cancel:l,toggle:l};return{eventsBin:e,setHandlers:function(t){t&&(t.play&&"function"==typeof t.play&&(e.play=u(t.play)),t.pause&&"function"==typeof t.pause&&(e.pause=u(t.pause)),t.cancel&&"function"==typeof t.cancel&&(e.cancel=u(t.cancel)),t.toggle&&"function"==typeof t.toggle&&(e.toggle=u(t.toggle)))}}}(),f=p.eventsBin,h=p.setHandlers,m=function(e){o=e,sessionStorage.getItem("readItToMeDisabled")&&v(!1)},v=function(e,t){var r;e?(d=!0,sessionStorage.removeItem("readItToMeDisabled")):(d=!1,(r=document.querySelector(".".concat(i)))&&r.classList.remove(i),n.cancel(),sessionStorage.setItem("readItToMeDisabled","1")),o.setReadItToMe(d),t&&f.toggle(e)},y=function(e){return function(){f.cancel(n.currentUtterance&&n.currentUtterance.config.group.ritmOptionalTrackingIdentifier),e.contains(this)&&e.focus(),n.cancel()}},b=function(e){if(n.currentUtterance&&n.currentUtterance.config.group===e&&e.state!==c.STOPPED)e.state===c.PAUSED?n.resume():e.state===c.PLAYING&&n.pause();else{var t={text:e.text(),group:e,playTracked:!1};n.play(t,g)}},g=function(e,t,n){n.group.setState(t),t===c.STOPPED?(o.hideControlBar(),o.hideCancelButton()):(o.showControlBar(),o.showCancelButton()),t===c.PLAYING?n.playTracked||(f.play(n.group.ritmOptionalTrackingIdentifier),n.playTracked=!0):t===c.PAUSED&&f.pause(n.group.ritmOptionalTrackingIdentifier)};function C(e,t){!function(e,t){var n=[],o=!1;if(e||"undefined"==typeof speechSynthesis||(e=speechSynthesis),e){var r=function t(){var n=a.currentUtterance=a.nextUttarance;function o(e){n.callback(e,c.STOPPED,n.config),a.nextUttarance?t():a.currentUtterance=null}a.nextUttarance=null,n.u.onend=function(){return setTimeout(o,100)},n.u.onerror=function(e){return setTimeout(o.bind(null,e.error||new Error("Unknown speech synthesis error")),100)},n.u.onstart=function(){return n.callback(null,c.PLAYING,n.config)},n.u.onpause=function(){return n.callback(null,c.PAUSED,n.config)},n.u.onresume=function(){return n.callback(null,c.PLAYING,n.config)},e.speak(n.u)},a={play:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=new SpeechSynthesisUtterance(t.text);if(i.lang="en-US",i.rate=.8,n.length>0)for(var c=0;c<n.length;c++)if(0===n[c].lang.indexOf("en")&&"Samantha"===n[c].name){i.voice=n[c];break}a.nextUttarance={u:i,config:t,callback:o},a.currentUtterance?e.cancel():r()},pause:function(){e.pause()},resume:function(){e.resume()},cancel:function(){e.cancel()}};0===(n=e.getVoices()).length&&(void 0!==e.onvoiceschanged?e.onvoiceschanged=function(){n=e.getVoices(),t(null,a)}:o=!0),e.cancel(),!n.length&&o?t(new Error("Unable to load voice list")):n.length&&t(null,a)}else t(new Error("Speech Synthesis is unavailable."))}(void 0,function(o,r){if(!o&&r){n=r;var a=e();a&&a.hideControlBar&&a.hideCancelButton&&a.showCancelButton&&a.showControlBar&&a.setReadItToMe?m(a):o=new Error("UI library did not provide necessary callbacks.")}t(o)})}var T,E,w=h;function k(e,t){var n=e.cancelAudio,o=e.setReadItToMe,r=t.document,a=t.controlBarElement,i=a||r.createElement("div");i.classList.add("read-it-to-me-control-bar"),i.setAttribute("tabindex","0"),i.setAttribute("aria-describedby","ritm-sr-message"),i.innerHTML='<div class="toggle-wrapper">\n                            <p class="visually-hidden" id="ritm-sr-message">Screen-reader users: there is a rudimentary "on-demand" read-aloud feature in use on this page called "Read-it-to-Me".  This new feature, which isn\'t meant as a screen-reader alternative, adds more tabable areas in the document which are great for keyboard users not using screen-readers, but are likely to be annoying for you. You can toggle off/on "Read-it-to-Me" using this checkbox.</p>\n                            <p class="read-it-to-me-label">Toggle Read-it-to-Me</p>\n                            <label class="switch" aria-label="Toggle Read-it-to-Me." aria-describedby="ritm-sr-message">\n                              <input type="checkbox" class="switch-input" checked>\n                              <span class="switch-outline"></span>\n                              <span class="switch-label" data-on="On" data-off="Off"></span>\n                              <span class="switch-handle"></span>\n                            </label>\n                          </div>\n                          <div class="cancel-audio-wrapper">\n                            <button type="button" class="btn btn-default btn-lg">Cancel audio</button>\n                          </div>';var c=i.querySelector("button"),s=i.querySelector("input.switch-input"),l=function(){i.classList.add("control-bar-show")},u=function(){i.classList.remove("control-bar-show")};if(c.addEventListener("click",n(i)),s.addEventListener("change",function(e){o(e.target.checked,!0)}),i.addEventListener("focusin",function(e){e.target&&i.contains(e.target)&&(i.classList.contains("control-bar-show")||l())}),i.addEventListener("focusout",function(e){(e.relatedTarget&&!i.contains(e.relatedTarget)||!e.relatedTarget)&&u()}),!a){var d=r.body;d.insertBefore(i,d.firstChild)}return{showCancelButton:function(){i.classList.add("show-ritm-cancel")},hideCancelButton:function(){i.classList.remove("show-ritm-cancel")},showControlBar:l,hideControlBar:u,setReadItToMe:function(e){return s.checked=e}}}function P(e,t){var n=e.playPauseGroup,o=e.cancelAudio,r=e.focusClassName,a=e.ritmDisabledClassName,i=e.ritmOptionalTrackingIdentifier,s=e.elem,l=e.text,u=t.wrapperElement,d=t.controlBubbleElement,p=t.document,f=u||p.createElement("div");if(f.classList.add("read-this-to-me"),!u)for(s.appendChild(f);s.firstChild!==f;)f.appendChild(s.firstChild);var h=d||p.createElement("div");h.classList.add("read-it-to-me-control-bubble"),h.tabIndex=-1,h.innerHTML='<p class="read-it-to-me-label"></p><button type="button" class="play-pause-resume"></button><button type="button" class="cancel-audio"><span class="visually-hidden">Cancel audio</a></button>';var m=h.querySelector("button.play-pause-resume"),v=h.querySelector("button.cancel-audio"),y=function(e){e.stopPropagation(),s.classList.add(r)},b=function(e){e.stopPropagation(),s.classList.remove(r)},g=function(e){e.stopPropagation(),n(T)},C=o(h);h.addEventListener("focusin",y),h.addEventListener("focusout",b),m.addEventListener("click",g),v.addEventListener("click",C),d||s.insertBefore(h,f);var T={setReadItToMe:function(e){e?s.classList.remove(a):s.classList.add(a),m.disabled=!e,v.disabled=!e},setState:function(e){T.state=e,e===c.STOPPED?(s.classList.remove("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===c.PLAYING?(s.classList.add("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===c.PAUSED&&(s.classList.remove("read-it-to-me-play"),s.classList.add("read-it-to-me-pause"))},state:c.STOPPED,destroy:function(){h.removeEventListener("focusin",y),h.removeEventListener("focusout",b),m.removeEventListener("click",g),v.removeEventListener("click",C)},text:l,ritmOptionalTrackingIdentifier:i};return T}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function I(e,t,n){return t&&B(e.prototype,t),n&&B(e,n),e}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?R(e):t}if(void 0!==t){var A=t.createContext(!0);T=function(e){function n(e){var t;return S(this,n),(t=U(this,x(n).call(this,e))).state={ritm:!0},t}return O(n,t.Component),I(n,[{key:"componentDidMount",value:function(){var e=this;C(function(){return e.controlBar=k({cancelAudio:y,setReadItToMe:v},{document:document}),{hideControlBar:e.controlBar.hideControlBar,hideCancelButton:e.controlBar.hideCancelButton,showCancelButton:e.controlBar.showCancelButton,showControlBar:e.controlBar.showControlBar,setReadItToMe:e.uiSetReadItToMe.bind(e)}},function(){}),w({play:this.onPlay.bind(this),pause:this.onPause.bind(this),cancel:this.onCancel.bind(this),toggle:this.onToggle.bind(this)})}},{key:"onPlay",value:function(){var e;this.props.onPlay&&(e=this.props).onPlay.apply(e,arguments)}},{key:"onPause",value:function(){var e;this.props.onPause&&(e=this.props).onPause.apply(e,arguments)}},{key:"onCancel",value:function(){var e;this.props.onCancel&&(e=this.props).onCancel.apply(e,arguments)}},{key:"onToggle",value:function(){var e;this.props.onToggle&&(e=this.props).onToggle.apply(e,arguments)}},{key:"uiSetReadItToMe",value:function(e){this.controlBar&&this.controlBar.setReadItToMe(e),this.setState({ritm:e})}},{key:"componentWillUnmount",value:function(){"undefined"!=typeof console&&console.error("Having the Read-it-to-Me Control Context unmount may cause unexpected side effects.")}},{key:"render",value:function(){return t.createElement(A.Provider,{value:this.state.ritm},this.props.children)}}]),n}(),E=function(e){function n(e){var t;return S(this,n),(t=U(this,x(n).call(this,e))).componentRender=t.componentRender.bind(R(t)),t}return O(n,t.Component),I(n,[{key:"componentRender",value:function(e){return t.createElement(N,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){L(e,t,n[t])})}return e}({},this.props,{ritmState:e}),this.props.children)}},{key:"render",value:function(){return t.createElement(A.Consumer,{},this.componentRender)}}]),n}();var N=function(e){function n(){return S(this,n),U(this,x(n).apply(this,arguments))}return O(n,t.Component),I(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.trackingIdentifier;this.ritmGroup=P({playPauseGroup:b,cancelAudio:y,focusClassName:i,ritmDisabledClassName:r,elem:this.elem,ritmOptionalTrackingIdentifier:t,text:function(){return s(e.wrapperElement)}},{wrapperElement:this.wrapperElement,controlBubbleElement:this.controlBubbleElement}),this.ritmGroup.setReadItToMe(this.props.ritmState)}},{key:"componentDidUpdate",value:function(e,t,n){e.ritmState!==this.props.ritmState&&this.ritmGroup.setReadItToMe(this.props.ritmState)}},{key:"componentWillUnmount",value:function(){this.ritmGroup&&(this.ritmGroup.destroy(),this.ritmGroup=null)}},{key:"render",value:function(){var e=this;return t.createElement("div",{className:a,ref:function(t){return e.elem=t}},t.createElement("div",{ref:function(t){return e.controlBubbleElement=t}}),t.createElement("div",{className:"read-this-to-me",ref:function(t){return e.wrapperElement=t}},this.props.children))}}]),n}()}var D=C,G=function(){return d},j=function(){return n.currentUtterance&&n.currentUtterance.config.group.ritmOptionalTrackingIdentifier||!1},q=w,H=T,_=E;e.ContentGroup=_,e.ControlContext=H,e.currentUtteranceIdentifier=j,e.eventTracking=q,e.init=function(e){return function(e,t){(t&&document.querySelectorAll(t).length>0||document.querySelectorAll(".".concat(a)).length>0)&&e(function(){var e;t&&document.querySelectorAll(t).length>0&&document.querySelectorAll(t).forEach(function(e){e.classList.add(a)});var n=[];return document.querySelectorAll(".".concat(a)).forEach(function(e){var t=e.dataset.ritmOptionalTrackingIdentifier||!1,o=P({playPauseGroup:b,cancelAudio:y,focusClassName:i,ritmDisabledClassName:r,elem:e,ritmOptionalTrackingIdentifier:t,text:function(){return s(e.querySelector(".read-this-to-me"))}},{document:document});n.push(o)}),{hideControlBar:(e=k({cancelAudio:y,setReadItToMe:v},{document:document})).hideControlBar,hideCancelButton:e.hideCancelButton,showCancelButton:e.showCancelButton,showControlBar:e.showControlBar,setReadItToMe:function(t){e.setReadItToMe(t),n.forEach(function(e){return e.setReadItToMe(t)})}}},function(e){e&&document.querySelectorAll(".".concat(a)).forEach(function(e){e.classList.remove(a,i)})})}(C,e)},e.initRITM=D,e.isEnabled=G,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=read-it-to-me.min.js.map
